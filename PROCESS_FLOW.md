# ğŸ”„ CheapForce Cloud - Complete Process Flow

A comprehensive visual guide to how CheapForce Cloud works from start to finish.

---

## ğŸ“‹ Table of Contents

- [Initial Setup](#-initial-setup)
- [User Authentication](#-user-authentication)
- [First-Time Sync](#-first-time-sync)
- [Ongoing Auto-Sync](#-ongoing-auto-sync)
- [Discord Commands](#-discord-commands)
- [Storage Management](#-storage-management)
- [Backup & Restore](#-backup--restore)
- [Plan Management](#-plan-management)

---

## ğŸš€ Initial Setup

### Server Setup Flow

```mermaid
graph TD
    A[Install Dependencies] --> B[Configure .env]
    B --> C[Register Discord Commands]
    C --> D[Start Server]
    D --> E[Discord Bot Connects]
    E --> F[Database Initialized]
    F --> G[Server Ready]
```

**Steps:**

1. **Install Dependencies**
   ```bash
   cd server
   npm install
   ```

2. **Configure Environment**
   ```env
   DISCORD_BOT_TOKEN=your_bot_token
   DISCORD_CLIENT_ID=your_app_id
   DISCORD_CHANNEL_ID=your_channel_id
   DISCORD_ADMIN_ID=your_user_id

   R2_ENDPOINT=https://account.r2.cloudflarestorage.com
   R2_ACCESS_KEY_ID=your_access_key
   R2_SECRET_ACCESS_KEY=your_secret_key
   R2_BUCKET_NAME=cheapforce-saves
   ```

3. **Register Commands**
   ```bash
   npm run register-commands
   ```
   âœ… Registers: `/link`, `/sync`, `/pull`, `/storage`, `/backup`, `/setplan`

4. **Start Server**
   ```bash
   npm run dev
   ```
   âœ… Server running on port 3000
   âœ… Discord bot connected
   âœ… Database created

---

### Client Setup Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Install Dependenciesâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Configure .env     â”‚
â”‚  SERVER_URL         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Start Client      â”‚
â”‚   npm run dev       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Custom Folder Createdâ”‚
â”‚ ~/CheapForceCloud/  â”‚
â”‚    CustomFiles/     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ready for Auth     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Steps:**

1. Install dependencies: `npm install`
2. Copy `.env.example` to `.env`
3. Set `SERVER_URL=http://localhost:3000`
4. Run `npm run dev`
5. Custom files folder auto-created
6. Client waits for authentication

---

## ğŸ” User Authentication

### Complete Authentication Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User    â”‚                 â”‚ Discord  â”‚                 â”‚  Server  â”‚
â”‚          â”‚                 â”‚   Bot    â”‚                 â”‚          â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
      â”‚                           â”‚                            â”‚
      â”‚  1. Type /link            â”‚                            â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                            â”‚
      â”‚                           â”‚                            â”‚
      â”‚                           â”‚  2. Generate 6-digit code  â”‚
      â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
      â”‚                           â”‚                            â”‚
      â”‚                           â”‚  3. Store in DB            â”‚
      â”‚                           â”‚  (expires in 15 min)       â”‚
      â”‚                           â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚                           â”‚                            â”‚
      â”‚  4. Send code via DM      â”‚                            â”‚
      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                            â”‚
      â”‚                           â”‚                            â”‚
â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”                      â”‚                            â”‚
â”‚  Client  â”‚                      â”‚                            â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                      â”‚                            â”‚
      â”‚                           â”‚                            â”‚
      â”‚  5. Enter code            â”‚                            â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
      â”‚                           â”‚                            â”‚
      â”‚                           â”‚  6. Verify code            â”‚
      â”‚                           â”‚  Create session            â”‚
      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚                           â”‚                            â”‚
      â”‚  7. Session token saved   â”‚                            â”‚
      â”‚  ~/.cheapforce-cloud/     â”‚                            â”‚
      â”‚  session.json             â”‚                            â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Detailed Steps:**

1. **User initiates in Discord**
   ```
   User: /link
   ```

2. **Bot generates code**
   - Creates random 6-digit number
   - Stores in database with Discord ID
   - Sets expiration (15 minutes)

3. **Code sent to user**
   ```
   â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
   â•‘ CheapForce Cloud - Link Account   â•‘
   â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
   â•‘ Linking Code: 123456               â•‘
   â•‘ Expires In: 15 minutes             â•‘
   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ```

4. **User enters code in client**
   ```
   Enter your 6-digit linking code: 123456
   ```

5. **Server validates**
   - Checks code exists
   - Verifies not expired
   - Marks code as used
   - Creates user if new
   - Generates session token

6. **Client receives session**
   ```json
   {
     "sessionId": "abc123...",
     "user": {
       "id": 1,
       "username": "UserName"
     }
   }
   ```

7. **Session saved locally**
   - File: `~/.cheapforce-cloud/session.json`
   - Persists across restarts
   - Used for all API calls

**Result:** âœ… User authenticated and ready to sync

---

## ğŸ® First-Time Sync

### Initial Sync Process

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   CLIENT STARTUP                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Load Configurations  â”‚
            â”‚ - games-config.json  â”‚
            â”‚ - apps-config.json   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  Detect User Plan    â”‚
            â”‚  (from server)       â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                             â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚   FREE   â”‚                â”‚ PLUS/    â”‚
    â”‚  Plan    â”‚                â”‚ PREMIUM  â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚                             â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚  Games   â”‚                â”‚  Games   â”‚
    â”‚  Only    â”‚                â”‚  + Apps  â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                â”‚  + Customâ”‚
         â”‚                      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚                            â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”˜
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Scan for Installed  â”‚
        â”‚  Games/Apps          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Show Detected Items  â”‚
        â”‚                      â”‚
        â”‚ âœ“ Minecraft          â”‚
        â”‚ âœ“ Terraria           â”‚
        â”‚ âœ“ VS Code (Plus+)    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ User Confirms Start  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Start File Watchers  â”‚
        â”‚ for each item        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Collect All Files   â”‚
        â”‚  in watched folders  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Initial Upload     â”‚
        â”‚   to R2 Storage      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ âœ… Sync Complete     â”‚
        â”‚ Monitoring started   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Console Output:**

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   CheapForce Cloud - Save Manager    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Welcome back, YourUsername!

Detected games:
  - Minecraft (/Users/you/Library/Application Support/minecraft/saves)
  - Terraria (/Users/you/Library/Application Support/Terraria)

Start monitoring 2 game(s)? (Y/n) y

Starting auto-sync...

Watching Minecraft:
  - /Users/you/Library/Application Support/minecraft/saves

Watching Terraria:
  - /Users/you/Library/Application Support/Terraria

Initial sync for minecraft: 15 file(s)

Syncing minecraft...
Uploading 15 file(s)
Successfully synced minecraft

âœ“ Auto-sync is running!
Saves sync every 5 minutes when changes are detected.
Use Discord commands /sync or /pull for manual control.
ğŸ“¡ Listening for Discord commands...
```

---

## âš¡ Ongoing Auto-Sync

### 5-Minute Batched Sync Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CONTINUOUS MONITORING                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Chokidar Watches    â”‚
              â”‚  All Configured      â”‚
              â”‚  Directories         â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ File Change Detected
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Mark as Pending     â”‚
              â”‚  Save file path      â”‚
              â”‚  in memory           â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Console Output:     â”‚
              â”‚  File changed        â”‚
              â”‚  (pending sync):     â”‚
              â”‚  world.dat           â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Wait for 5-minute   â”‚
              â”‚  interval timer      â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ Timer Triggers
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”Œâ”€â”€â”€â”€â”¤  Pending Changes?    â”‚
         â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚               â”‚
    NO   â”‚               â”‚ YES
         â”‚               â–¼
         â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚    â”‚  Console Output:     â”‚
         â”‚    â”‚  â° Scheduled sync   â”‚
         â”‚    â”‚  triggered for       â”‚
         â”‚    â”‚  minecraft           â”‚
         â”‚    â”‚  (3 changes)         â”‚
         â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚               â”‚
         â”‚               â–¼
         â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚    â”‚  Collect ALL Files   â”‚
         â”‚    â”‚  in watched folder   â”‚
         â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚               â”‚
         â”‚               â–¼
         â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚    â”‚  Upload to R2        â”‚
         â”‚    â”‚  Storage             â”‚
         â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚               â”‚
         â”‚               â–¼
         â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚    â”‚  Update Database     â”‚
         â”‚    â”‚  - storage_used      â”‚
         â”‚    â”‚  - last_sync         â”‚
         â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚               â”‚
         â”‚               â–¼
         â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚    â”‚  Clear Pending       â”‚
         â”‚    â”‚  Changes             â”‚
         â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚               â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Wait for Next       â”‚
              â”‚  Interval (5 min)    â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â””â”€â”€â”€â”€â”€â”€â”
                                â”‚
                      (Loop Forever)
```

**Timeline Example:**

```
00:00:00 - User plays Minecraft, saves game
00:00:01 - [File changed (pending sync): level.dat]

00:02:30 - User makes another save
00:02:31 - [File changed (pending sync): level.dat]

00:04:15 - User exits game
00:04:16 - [File changed (pending sync): session.lock]

00:05:00 - [â° Scheduled sync triggered for minecraft (3 changes detected)]
00:05:01 - [Syncing minecraft...]
00:05:02 - [Uploading 15 file(s)]
00:05:05 - [Successfully synced minecraft]

00:10:00 - (No changes - no sync)
00:15:00 - (No changes - no sync)
...
```

**Storage Structure After Sync:**

```
R2 Bucket: cheapforce-cloud-saves
â”‚
â””â”€â”€ users/
    â””â”€â”€ 1/
        â””â”€â”€ games/
            â””â”€â”€ minecraft/
                â”œâ”€â”€ level.dat
                â”œâ”€â”€ level.dat_old
                â”œâ”€â”€ session.lock
                â”œâ”€â”€ advancements/
                â”‚   â””â”€â”€ user.json
                â””â”€â”€ stats/
                    â””â”€â”€ user.json
```

---

## ğŸ›ï¸ Discord Commands

### Command: `/sync` (Force Sync)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User    â”‚          â”‚ Discord  â”‚          â”‚  Server  â”‚          â”‚  Client  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚  1. /sync           â”‚                     â”‚                     â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                     â”‚                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚  2. Verify User     â”‚                     â”‚
     â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚  3. Create Request  â”‚                     â”‚
     â”‚                     â”‚  (type: 'sync')     â”‚                     â”‚
     â”‚                     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚  4. Confirmation    â”‚                     â”‚                     â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚                     â”‚
     â”‚  "Sync request sent"â”‚                     â”‚                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚  5. Notification    â”‚                     â”‚
     â”‚                     â”‚  posted in channel  â”‚                     â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚                     â”‚  6. Poll (every 10s)â”‚
     â”‚                     â”‚                     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚                     â”‚  7. Return Request  â”‚
     â”‚                     â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚                     â”‚  8. Execute Sync    â”‚
     â”‚                     â”‚                     â”‚  forceSyncAll()     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚                     â”‚  9. Upload Files    â”‚
     â”‚                     â”‚                     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
     â”‚                     â”‚                     â”‚            â”‚        â”‚
     â”‚                     â”‚                     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚                     â”‚ 10. Mark Complete   â”‚
     â”‚                     â”‚                     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                     â”‚                     â”‚                     â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Console Output:**

```
ğŸ“¡ Listening for Discord commands...

ğŸ”” Discord command received: /sync

ğŸ”„ Force sync triggered for ALL games

Syncing minecraft...
Uploading 15 file(s)
Successfully synced minecraft

Syncing terraria...
Uploading 8 file(s)
Successfully synced terraria

âœ… Force sync completed
```

---

### Command: `/pull` (Force Pull)

```
User â†’ Discord: /pull
       â”‚
       â–¼
Discord â†’ Server: Create pull request
       â”‚
       â–¼
Client (polling): Detect request
       â”‚
       â–¼
Client: Download saves for each game
       â”‚
       â”œâ”€â–º Download minecraft saves as ZIP
       â”œâ”€â–º Extract to local folder
       â”œâ”€â–º Overwrite existing files
       â”‚
       â”œâ”€â–º Download terraria saves as ZIP
       â”œâ”€â–º Extract to local folder
       â””â”€â–º Overwrite existing files
       â”‚
       â–¼
Client â†’ Server: Mark complete
       â”‚
       â–¼
âœ… All saves restored
```

**Console Output:**

```
ğŸ”” Discord command received: /pull

Downloading latest saves...
  âœ“ minecraft restored
  âœ“ terraria restored

âœ… Force pull completed
```

---

### Command: `/storage` (View Usage)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User    â”‚          â”‚ Discord  â”‚          â”‚  Server  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                     â”‚                     â”‚
     â”‚  1. /storage        â”‚                     â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                     â”‚
     â”‚                     â”‚                     â”‚
     â”‚                     â”‚  2. Verify User     â”‚
     â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚                     â”‚                     â”‚
     â”‚                     â”‚  3. Calculate       â”‚
     â”‚                     â”‚  Storage Used       â”‚
     â”‚                     â”‚  - List R2 files    â”‚
     â”‚                     â”‚  - Sum sizes        â”‚
     â”‚                     â”‚  - Update DB        â”‚
     â”‚                     â”‚                     â”‚
     â”‚                     â”‚  4. Get Plan Info   â”‚
     â”‚                     â”‚  - Storage limit    â”‚
     â”‚                     â”‚  - Features         â”‚
     â”‚                     â”‚                     â”‚
     â”‚                     â”‚  5. Generate        â”‚
     â”‚                     â”‚  Progress Bar       â”‚
     â”‚                     â”‚                     â”‚
     â”‚                     â”‚  6. Return Embed    â”‚
     â”‚                     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                     â”‚                     â”‚
     â”‚  7. Display Result  â”‚                     â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Discord Output:**

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ ğŸ“Š CheapStorage+ - Storage Usage     â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                      â•‘
â•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘          â•‘
â•‘                                      â•‘
â•‘   Used         Total      Available  â•‘
â•‘   2.5 GB       10 GB      7.5 GB    â•‘
â•‘                                      â•‘
â•‘   Percentage                         â•‘
â•‘   ğŸŸ¢ 25.00%                          â•‘
â•‘                                      â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ User ID: 1                           â•‘
â•‘ Timestamp: 2025-10-25 02:30:45 UTC  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

**Under the Hood:**

```typescript
// 1. List all user files from R2
const files = await R2Storage.listFilesWithMetadata(userId);
// Returns: [
//   { key: 'users/1/games/minecraft/level.dat', size: 1024000 },
//   { key: 'users/1/games/terraria/world.wld', size: 2048000 },
//   ...
// ]

// 2. Calculate total
const totalBytes = files.reduce((sum, f) => sum + f.size, 0);
// Result: 2621440000 bytes (2.5 GB)

// 3. Update database
userOps.updateStorageUsed.run(totalBytes, userId);

// 4. Get plan info
const limit = PLAN_LIMITS[user.plan].storage; // 10GB
const percentUsed = (totalBytes / limit) * 100; // 25%

// 5. Generate progress bar
const bar = generateProgressBar(25, 25);
// Result: "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘"

// 6. Format for display
const used = formatBytes(2621440000);    // "2.5 GB"
const total = formatBytes(10737418240);  // "10 GB"
const avail = formatBytes(8115978240);   // "7.5 GB"
```

---

### Command: `/backup` (Download Backup)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   BACKUP GENERATION FLOW                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  User Types /backup  â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  Show "Creating..."  â”‚
           â”‚  Please wait message â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  List All User Files â”‚
           â”‚  from R2 Storage     â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”œâ”€â”€â–º games/minecraft/level.dat
                       â”œâ”€â”€â–º games/terraria/world.wld
                       â”œâ”€â”€â–º apps/vscode/settings.json
                       â””â”€â”€â–º custom/photo.jpg
                       â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  Download Each File  â”‚
           â”‚  from R2             â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  Create ZIP Archive  â”‚
           â”‚  in Memory           â”‚
           â”‚                      â”‚
           â”‚  Structure:          â”‚
           â”‚  â”œâ”€â”€ games/          â”‚
           â”‚  â”œâ”€â”€ apps/           â”‚
           â”‚  â””â”€â”€ custom/         â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  Check File Size     â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                           â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚ < 25 MB  â”‚              â”‚ > 25 MB  â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚                           â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚  Send as â”‚              â”‚ Upload   â”‚
    â”‚  Discord â”‚              â”‚ to R2    â”‚
    â”‚  Attach  â”‚              â”‚          â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚                           â”‚
         â”‚                      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
         â”‚                      â”‚ Generateâ”‚
         â”‚                      â”‚ Presign â”‚
         â”‚                      â”‚ URL     â”‚
         â”‚                      â”‚ (1 hour)â”‚
         â”‚                      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚                           â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Send to User        â”‚
        â”‚  via Discord         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Small Backup (< 25MB):**

```
User: /backup

Bot: â³ Creating your backup archive... This may take a moment.

Bot: âœ… Your backup is ready! (12.5 MB)
     ğŸ“ cheapforce-backup-username-1698765432.zip
```

**Large Backup (> 25MB):**

```
User: /backup

Bot: â³ Creating your backup archive... This may take a moment.

Bot: âœ… Your backup is ready!

     âš ï¸ File is too large for Discord (45.8 MB)

     ğŸ”— Download link (valid for 1 hour):
     https://account.r2.cloudflarestorage.com/cheapforce-saves/
     users/1/custom/backup-1698765432.zip?X-Amz-Algorithm=...
```

---

## ğŸ“Š Storage Management

### Storage Quota Check Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BEFORE EVERY UPLOAD                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  Get User from DB    â”‚
           â”‚  - current plan      â”‚
           â”‚  - storage_used      â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  Calculate New Size  â”‚
           â”‚  current + upload    â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  Get Plan Limit      â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                           â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚ Within   â”‚              â”‚  Over    â”‚
    â”‚ Quota    â”‚              â”‚  Quota   â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚                           â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚  Allow   â”‚              â”‚  Reject  â”‚
    â”‚  Upload  â”‚              â”‚  Upload  â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚                           â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚ Upload   â”‚              â”‚  Return  â”‚
    â”‚ to R2    â”‚              â”‚  Error   â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜              â”‚  402     â”‚
         â”‚                    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”                    â”‚
    â”‚ Update   â”‚                    â”‚
    â”‚ storage_ â”‚                    â”‚
    â”‚ used     â”‚                    â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                    â”‚
         â”‚                           â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Return Result      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Example Scenarios:**

**Scenario 1: Upload Allowed**
```
User Plan: Plus (10 GB limit)
Current Usage: 8.5 GB
Upload Size: 1.2 GB
New Total: 9.7 GB âœ… ALLOWED

âœ“ Uploading 15 file(s)
âœ“ Successfully synced minecraft
Storage: 9.7 GB / 10 GB (97%)
```

**Scenario 2: Upload Rejected**
```
User Plan: Free (1 GB limit)
Current Usage: 950 MB
Upload Size: 100 MB
New Total: 1.05 GB âŒ REJECTED

âŒ Upload failed: Storage quota exceeded
   Used: 950 MB
   Limit: 1 GB
   Attempted: +100 MB

Please:
1. Use /storage to check usage
2. Delete old backups
3. Upgrade plan with /setplan (admin)
```

---

## ğŸ”„ Plan Management

### Admin Plan Change Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Admin   â”‚          â”‚ Discord  â”‚          â”‚  Server  â”‚          â”‚  Client  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚  /setplan @User     â”‚                     â”‚                     â”‚
     â”‚  premium            â”‚                     â”‚                     â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                     â”‚                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚  Verify Admin       â”‚                     â”‚
     â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚  Check User Exists  â”‚                     â”‚
     â”‚                     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚  Update DB:         â”‚                     â”‚
     â”‚                     â”‚  plan = 'premium'   â”‚                     â”‚
     â”‚                     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚  Confirmation (DM)  â”‚                     â”‚                     â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚                     â”‚
     â”‚  "Updated to        â”‚                     â”‚                     â”‚
     â”‚   PREMIUM"          â”‚                     â”‚                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚  Notification       â”‚                     â”‚                     â”‚
     â”‚  (public channel)   â”‚                     â”‚                     â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚                     â”‚
     â”‚  "@User upgraded    â”‚                     â”‚                     â”‚
     â”‚   to CheapStorage++"â”‚                     â”‚                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚                     â”‚  Next /verify API   â”‚
     â”‚                     â”‚                     â”‚  call detects plan  â”‚
     â”‚                     â”‚                     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚                     â”‚  Return new plan    â”‚
     â”‚                     â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚                     â”‚  Client detects:    â”‚
     â”‚                     â”‚                     â”‚  - Premium features â”‚
     â”‚                     â”‚                     â”‚  - Custom folder    â”‚
     â”‚                     â”‚                     â”‚  - 100GB quota      â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**What Changes Immediately:**

```
Database:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ users table                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id: 1                       â”‚
â”‚ plan: 'free' â†’ 'premium'   â”‚ âœ… Updated
â”‚ storage_used: 512000000     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Feature Access:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Before (Free):              â”‚
â”‚ âœ… Games                    â”‚
â”‚ âŒ Apps                     â”‚
â”‚ âŒ Custom Files             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ After (Premium):            â”‚
â”‚ âœ… Games                    â”‚
â”‚ âœ… Apps                     â”‚ âœ… Unlocked
â”‚ âœ… Custom Files             â”‚ âœ… Unlocked
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Storage Quota:
1 GB â†’ 100 GB âœ… Updated
```

**Client-Side Effects:**

```
Next client startup or sync:

1. Client calls /api/auth/verify
2. Server returns updated user object:
   {
     "plan": "premium",
     "storage_used": 512000000
   }

3. Client detects premium plan:
   âœ“ Loads apps-config.json
   âœ“ Creates CustomFiles folder (if not exists)
   âœ“ Starts watching custom folder
   âœ“ Updates UI/console messages

Console Output:
ğŸ“¦ Plan upgraded to Premium!
   âœ“ Apps backup enabled
   âœ“ Custom files enabled
   âœ“ Storage: 512 MB / 100 GB
   ğŸ“ Custom folder: ~/CheapForceCloud/CustomFiles/
```

---

## ğŸ¯ Complete User Journey

### Day 1: Setup & First Sync

```
09:00 AM - User joins Discord server
         - Sees CheapForce Cloud bot

09:05 AM - User types: /link
         - Receives code: 123456

09:06 AM - User downloads client
         - Runs: npm install && npm run dev
         - Enters code: 123456
         - âœ… Linked successfully

09:10 AM - Client detects games:
         - âœ“ Minecraft
         - âœ“ Terraria

09:11 AM - User confirms: Start monitoring? Y
         - Initial sync begins
         - 15 files uploaded for Minecraft
         - 8 files uploaded for Terraria
         - âœ… All synced

09:15 AM - Client running in background
         - Monitoring for changes
         - Next sync in 5 minutes
```

### Day 3: Using Discord Commands

```
10:30 AM - User at work, wants to check storage
         - Types: /storage
         - Sees: 450 MB / 1 GB (45%)
         - ğŸŸ¢ Still plenty of space

02:15 PM - User wants latest saves on work computer
         - Types: /pull
         - Client downloads and restores
         - âœ… Ready to play at work

06:00 PM - User back home, made changes at work
         - Types: /sync
         - Home client uploads immediately
         - âœ… Work progress backed up
```

### Week 2: Upgrade to Plus

```
Monday
11:00 AM - User wants to backup VS Code settings
         - Contacts admin
         - Admin: /setplan @User plus
         - âœ… Upgraded to 10 GB

11:05 AM - Client auto-detects upgrade
         - Loads apps-config.json
         - Starts watching VS Code folder
         - Syncs settings immediately

11:10 AM - User types: /storage
         - Sees: 450 MB / 10 GB (4.5%)
         - ğŸŸ¢ Lots of room now
```

### Month 3: Premium Features

```
15th
04:00 PM - User upgraded to Premium
         - Admin: /setplan @User premium
         - âœ… 100 GB + Custom Files

04:05 PM - Client creates CustomFiles folder
         - ~/CheapForceCloud/CustomFiles/
         - README.txt explains usage

04:10 PM - User drops project files in folder
         - project.zip (500 MB)
         - documents.zip (200 MB)

04:15 PM - Auto-sync uploads custom files
         - âœ“ project.zip uploaded
         - âœ“ documents.zip uploaded

04:20 PM - User types: /storage
         - Sees: 1.15 GB / 100 GB (1.15%)
         - ğŸŸ¢ Plenty of space

04:25 PM - User types: /backup
         - Receives download link (45 MB)
         - Complete backup of everything
```

---

## ğŸ¨ Visual Summary

### Complete System Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER INTERACTION                             â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                                                           â”‚
     â–¼                                                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Discord  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  Client  â”‚
â”‚   Bot    â”‚          Commands & Responses                 â”‚  (PC)    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                                                          â”‚
     â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
     â”‚ â”‚ Commands:           â”‚                                â”‚
     â”‚ â”‚ /link    /storage   â”‚                                â”‚
     â”‚ â”‚ /sync    /backup    â”‚                                â”‚
     â”‚ â”‚ /pull    /setplan   â”‚                                â”‚
     â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
     â”‚                                                          â”‚
     â–¼                                                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           SERVER (Node.js)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  Auth    â”‚  â”‚  Routes  â”‚  â”‚ Storage  â”‚  â”‚ Database â”‚        â”‚
â”‚  â”‚  System  â”‚  â”‚   API    â”‚  â”‚  Utils   â”‚  â”‚  SQLite  â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                                                        â”‚
     â–¼                                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    R2    â”‚                                           â”‚ Database â”‚
â”‚ Storage  â”‚                                           â”‚   .db    â”‚
â”‚ (Cloud)  â”‚                                           â”‚  (Local) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Data Flow

```
Client Files  â†’  Monitoring  â†’  5-Min Batch  â†’  Upload  â†’  R2 Storage
                                                           â”‚
                                                           â–¼
                                                      User's Cloud
                                                      â”œâ”€â”€ games/
                                                      â”œâ”€â”€ apps/
                                                      â””â”€â”€ custom/

Discord CMD   â†’  Server      â†’  Database     â†’  Client Poll  â†’  Action
(/sync)          (Queue)         (Pending)        (Execute)      (Upload)
```

---

## ğŸ“š Quick Reference

### Timeline for Common Actions

| Action | Duration | Notes |
|--------|----------|-------|
| Auth code generation | < 1 second | Instant in Discord |
| Auth code expiration | 15 minutes | Must use before expires |
| Client startup | 2-5 seconds | Loads configs, connects |
| Initial sync | 10-60 seconds | Depends on file count |
| Auto-sync interval | 5 minutes | Configurable |
| Discord command poll | 10 seconds | Client checks server |
| Force sync execution | 10-60 seconds | Immediate upload |
| Storage calculation | 5-15 seconds | Lists R2 files |
| Backup generation | 30-300 seconds | Depends on size |
| Presigned URL validity | 1 hour | For large downloads |

### Port Reference

| Service | Port | Protocol |
|---------|------|----------|
| Server HTTP API | 3000 | HTTP |
| Discord Bot | 443 | WSS |
| Cloudflare R2 | 443 | HTTPS |

### File Paths

| Item | Windows | macOS | Linux |
|------|---------|-------|-------|
| Session | `%USERPROFILE%\.cheapforce-cloud\session.json` | `~/.cheapforce-cloud/session.json` | `~/.cheapforce-cloud/session.json` |
| Custom Files | `C:\Users\You\CheapForceCloud\CustomFiles` | `~/CheapForceCloud/CustomFiles` | `~/CheapForceCloud/CustomFiles` |
| Server DB | `server\data\cheapforce.db` | `server/data/cheapforce.db` | `server/data/cheapforce.db` |

---

## âœ… Success Indicators

### Setup Complete When:
- âœ… Server shows: "Ready to accept connections!"
- âœ… Discord bot status: Online (green dot)
- âœ… Client shows: "Welcome back, [username]!"
- âœ… `/link` command works in Discord

### Sync Working When:
- âœ… Console shows: "Watching [game]"
- âœ… File changes show: "(pending sync)"
- âœ… Every 5 min: "Scheduled sync triggered"
- âœ… `/storage` shows increasing usage

### Commands Working When:
- âœ… `/storage` shows ASCII bar
- âœ… `/backup` returns file or URL
- âœ… `/sync` triggers immediate upload
- âœ… `/pull` downloads and extracts

### Plans Working When:
- âœ… `/setplan` updates successfully
- âœ… User sees new quota in `/storage`
- âœ… Client detects plan change
- âœ… Features unlock automatically

---

**ğŸ‰ That's the complete flow! Everything is automated, visual, and easy to understand.**

For more details, see:
- [PLANS.md](PLANS.md) - Plan details
- [SETUP_PLANS.md](SETUP_PLANS.md) - Setup guide
- [README.md](README.md) - Full documentation
